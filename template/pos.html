$def with (site_prefix, devices, posname)
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<style type="text/css">
<!--
html {
    height:100%;
}
body {
    margin-left: 0px;
    margin-top: 0px;
    margin-right: 0px;
    margin-bottom: 0px;
    height:100%;
}

.STYLE1 {
    font-size: 12px
}

.STYLE3 {
    font-size: 12px;
    font-weight: bold;
}

.STYLE4 {
    color: #03515d;
    font-size: 12px;
}
img {
   border: 0px; 
}
.STYLE5 {
    font-size: 16px;
    font-weight: bold;
}
-->
#container{height:100%} 
</style>
<script type="text/javascript" src="http://api.map.baidu.com/api?v=1.5&ak=PkztGytCOmGprnY4cIlfamsm"></script>
</head>
<body>
    <table width="100%" border="0" cellspacing="0" cellpadding="0">
        <tr>
            <td height="30" background="$site_prefix/img/tab_05.gif">
                <table width="100%" border="0" cellspacing="0" cellpadding="0">
                    <tr>
                        <td width="12" height="30"><img src="$site_prefix/img/tab_03.gif"
                            width="12" height="30" />
                        </td>
                        <td>
                            <table width="100%" border="0" cellspacing="0" cellpadding="0">
                                <tr>
                                    <td width="46%" valign="middle">
                                        <table width="100%" border="0" cellspacing="0" cellpadding="0">
                                            <tr>
                                                <td width="5%">
                                                    <div align="center">
                                                        <img src="$site_prefix/img/tb.gif" width="16" height="16" />
                                                    </div></td>
                                                <td width="95%" class="STYLE1"><span class="STYLE3">当前位置</span>：<a href="$site_prefix/view">[终端状态查看]</a>-[终端地理信息查看]</td>
                                            </tr>
                                        </table></td>
                                    <td width="54%"><table border="0" align="right"
                                            cellpadding="0" cellspacing="0">
                                            <tr>
                                                <td width="60">
                                                    <table width="87%" border="0" cellpadding="0"
                                                        cellspacing="0">
                                                    </table></td>
                                                <td width="60"><table width="90%" border="0"
                                                        cellpadding="0" cellspacing="0">

                                                    </table>
                                                </td>
                                            </tr>
                                        </table>
                                    </td>
                                </tr>
                            </table>
                        </td>
                        <td width="16"><img src="$site_prefix/img/tab_07.gif" width="16"
                            height="30" />
                        </td>
                    </tr>
                </table>
            </td>
        </tr>
        <tr>
            <td><table width="100%" border="0" cellspacing="0"
                    cellpadding="0">
                    <tr>
                        <td width="8" background="$site_prefix/img/tab_12.gif">&nbsp;</td>
                        <td><table width="100%" border="0" cellpadding="0"
                                cellspacing="1" bgcolor="b5d6e6" onmouseover="changeto()"
                                onmouseout="changeback()">
                                <tr>
                                    <td width="10%" height="22" background="$site_prefix/img/bg.gif"
                                        bgcolor="#FFFFFF"><div align="center">
                                            <span class="STYLE1">终端唯一标识</span>
                                        </div>
                                    </td>
                                    <td width="10%" height="22" background="$site_prefix/img/bg.gif"
                                        bgcolor="#FFFFFF"><div align="center">
                                            <span class="STYLE1">终端名称</span>
                                        </div>
                                    </td>
                                    <td width="10%" height="22" background="$site_prefix/img/bg.gif"
                                        bgcolor="#FFFFFF"><div align="center">
                                            <span class="STYLE1">终端类型</span>
                                        </div>
                                    </td>
                                    <td width="10%" background="$site_prefix/img/bg.gif" bgcolor="#FFFFFF"><div
                                            align="center">
                                            <span class="STYLE1">终端使用人</span>
                                        </div>
                                    </td>
                                    <td width="10%" background="$site_prefix/img/bg.gif" bgcolor="#FFFFFF"><div
                                            align="center">
                                            <span class="STYLE1">终端绑定用户</span>
                                        </div>
                                    </td>      
                                    <td width="10%" height="22" background="$site_prefix/img/bg.gif"
                                        bgcolor="#FFFFFF"><div align="center">
                                            <span class="STYLE1">终端所属群组</span>
                                        </div>
                                    </td>   
                                    <td width="5%" height="22" background="$site_prefix/img/bg.gif"
                                        bgcolor="#FFFFFF"><div align="center">
                                            <span class="STYLE1">状态</span>
                                        </div>
                                    </td>    
                                    <td width="10%" height="22" background="$site_prefix/img/bg.gif"
                                        bgcolor="#FFFFFF"><div align="center">
                                            <span class="STYLE1">最后更新时间</span>
                                        </div>
                                    </td>
                                    <td width="20%" height="22" background="$site_prefix/img/bg.gif"
                                        bgcolor="#FFFFFF"><div align="center">
                                            <span class="STYLE1">终端地理位置</span>
                                        </div>
                                    </td>    
                                    <td width="10%" height="22" background="$site_prefix/img/bg.gif"
                                        bgcolor="#FFFFFF"><div align="center">
                                            <span class="STYLE1">操作</span>
                                        </div>
                                    </td>                                                                                                    
                                </tr>
                                $for key in devices:
                                    <tr>
                                        <td height="20" bgcolor="#FFFFFF"><div align="center"
                                                class="STYLE1">
                                                <div align="center">$devices[key][0]</div>
                                            </div>
                                        </td>
                                        <td height="20" bgcolor="#FFFFFF"><div align="center">
                                                <span class="STYLE1">$devices[key][1]</span>
                                            </div>
                                        </td>
                                        <td height="20" bgcolor="#FFFFFF"><div align="center">
                                                <span class="STYLE1">$devices[key][2]</span>
                                            </div>
                                        </td>
                                        <td bgcolor="#FFFFFF"><div align="center">
                                                <span class="STYLE1">
                                                    <select>
                                                        $for each in devices[key][3]:
                                                            <option>$each</option>
                                                    </select>
                                                </span>
                                            </div>
                                        </td>
                                        <td bgcolor="#FFFFFF"><div align="center">
                                                <span class="STYLE1">
                                                    <select>
                                                        $for each in devices[key][4]:
                                                            <option>$each</option>
                                                    </select>
                                                </span>
                                            </div>
                                        </td>  
                                        <td height="20" bgcolor="#FFFFFF"><div align="center">
                                                <span class="STYLE1">
                                                    <select>
                                                        $for each in devices[key][5]:
                                                            <option>$each</option>
                                                    </select>
                                                </span>
                                            </div>
                                        </td>     
                                        <td height="20" bgcolor="#FFFFFF"><div align="center">
                                                <span class="STYLE1">$devices[key][6]</span>
                                            </div>
                                        </td> 
                                        <td height="20" bgcolor="#FFFFFF"><div align="center">
                                                <span class="STYLE1">$devices[key][7]</span>
                                            </div>
                                        </td>    
                                        <td height="20" bgcolor="#FFFFFF"><div align="center">
                                                <span class="STYLE1">$posname[devices[key][0]]</span>
                                            </div>
                                        </td>    
                                        <td height="20" bgcolor="#FFFFFF"><div align="center">
                                                <span class="STYLE1">
                                                    $ pos = devices[key][9]
                                                    <input type=button value="跳转" onclick="movetonewpos($pos)">
                                                </span>
                                            </div>
                                        </td>                         
                                    </tr>
                            </table>
                        </td>
                        <td width="8" background="$site_prefix/img/tab_15.gif">&nbsp;</td>
                    </tr>
                </table>
            </td>
        </tr>
    </table>
$if len(devices) != 0:
    <div id="container">
    <script type="text/javascript">
        var map = new BMap.Map("container");          // 创建地图实例
        $for key in devices:
            var point = new BMap.Point($devices[key][9]);  // 创建点坐标
            $break
        map.centerAndZoom(point, 15);                 // 初始化地图，设置中心点坐标和地图级别
        map.addControl(new BMap.NavigationControl());
        map.addControl(new BMap.ScaleControl());
        map.addControl(new BMap.OverviewMapControl);
        map.addControl(new BMap.MapTypeControl({mapTypes: [BMAP_NORMAL_MAP, BMAP_SATELLITE_MAP, BMAP_HYBRID_MAP]}));
        map.enableScrollWheelZoom();
        function movetonewpos(x, y) {
            var newcenter = new BMap.Point(x, y);  // 创建点坐标
            map.panTo(newcenter);
        }
        $for key in devices:         
            var point = new BMap.Point($devices[key][9]);  // 创建点坐标
            var myIcon = new BMap.Icon("$site_prefix/img/marker.png", new BMap.Size(48, 48), {    
                anchor: new BMap.Size(24, 48),  
                infoWindowAnchor: new BMap.Size(24, 0)   
            });    
            var marker = new BMap.Marker(point, {icon: myIcon});
            var label = new BMap.Label("$devices[key][1]",{offset:new BMap.Size(30,-15)});
            marker.setLabel(label);
            map.addOverlay(marker);
            var opts = {  
                width : 300,     // 信息窗口宽度  
                height: 100,     // 信息窗口高度  
                enableMessage: false,
            }     
            marker.addEventListener("click", function(e){  
                this.openInfoWindow(new BMap.InfoWindow("<font size=2>终端名称：$devices[key][1] <br> 终端类型：$devices[key][2] <br> 状态：$devices[key][6] <br>最后更新时间：$devices[key][7]<br>位置：$posname[devices[key][0]]<br>坐标：$devices[key][9]</font>", opts));      // 打开信息窗口
            })    
    </script>
    </div>
</body>
</html>
